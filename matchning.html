<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>ğŸ¯ Matcha recensent</title>

<style>
:root {
  --bg:#0e0e11;
  --panel:#18181f;
  --text:#eaeaf0;
  --muted:#a0a0b0;
  --border:#2a2a35;

  --good:#4ade80;
  --warn:#facc15;
  --bad:#f87171;
}

body {
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header {
  background:linear-gradient(90deg,#000,#111);
  border-bottom:1px solid var(--border);
  padding:20px;
}

.header-inner {
  max-width:1300px;
  margin:auto;
  display:flex;
  align-items:center;
  gap:20px;
}

header img { height:60px; }

.top-nav{
  margin-left:auto;
  display:flex;
  gap:12px;
}

.top-nav a{
  text-decoration:none;
  padding:8px 14px;
  background:#f2f2f2;
  border-radius:6px;
  color:#333;
  font-weight:bold;
}

main {
  max-width:1300px;
  margin:auto;
  padding:30px 20px;
}

.panel {
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:10px;
  padding:20px;
  margin-bottom:30px;
}

h2 {
  margin-top:0;
  border-bottom:1px solid var(--border);
  padding-bottom:6px;
}

select, button {
  background:#111;
  color:var(--text);
  border:1px solid var(--border);
  padding:8px;
  border-radius:6px;
}

button { cursor:pointer; }

.result {
  border:1px solid var(--border);
  border-radius:8px;
  padding:14px;
  margin-bottom:12px;
  background:#111;
}

.score {
  font-size:1.2rem;
  font-weight:700;
}

.good { color:var(--good); }
.warn { color:var(--warn); }
.bad { color:var(--bad); }

.reason {
  font-size:0.9rem;
  color:var(--muted);
  margin-top:6px;
}

footer {
  margin-top:40px;
  padding:20px;
  text-align:center;
  color:var(--muted);
}
.top-nav a.active {
  background:#e11d48;
  color:#fff;
}

.header-logo-right {
  margin-left: auto;
}

/* ===== MATCHNING â€“ LAYOUT ===== */

.match-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
}

.match-section {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.pc-box {
  background: #111;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px;
}

.pc-box h3 {
  margin: 0 0 10px 0;
  font-size: 1rem;
  color: var(--muted);
}

.match-actions {
  margin-top: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}


</style>
</head>

<body>

<header>
  <div class="header-inner">
    <img src="Logo_Nerdlife.png">
    <h1>ğŸ¯ Matchning</h1>

    <nav class="top-nav">
      <a href="index.html">ğŸ‘¤ Personvy</a>
      <a href="matchning.html" class="active">ğŸ¯ Matchning</a>
      <a href="ej-valda.html">ğŸš« Ej valda</a>
      <a href="heatmap.html">ğŸ”¥ Heatmap</a>
      <a href="statistik.html">ğŸ“Š Statistik</a>
    </nav>

    <img src="LOGOTYP-Prototyp-2023-pureLOGO-.png" class="header-logo-right">
  </div>
</header>

<main>

<div class="panel">
  <h2>ğŸ® Spelinformation</h2>

  <div class="match-grid">

    <!-- VÃ„NSTER KOLUMN -->
    <div class="match-section">

      <p>
        <label>Genre</label><br>
        <select id="genreSelect">
          <option value="">â€“ VÃ¤lj genre â€“</option>
        </select>
      </p>

      <p>
        <label>Plattform</label><br>
        <select id="plattformSelect">
          <option value="">â€“ VÃ¤lj â€“</option>
          <option value="PC">PC</option>
          <option value="Playstation 5">PlayStation 5</option>
          <option value="Xbox Series S|X">Xbox Series S|X</option>
          <option value="Nintendo Switch">Nintendo Switch</option>
          <option value="Switch 2">Switch 2</option>
        </select>
      </p>

    </div>

    <!-- HÃ–GER KOLUMN -->
    <div class="match-section">

      <div class="pc-box">
        <h3>ğŸ–¥ï¸ PC-krav (endast PC)</h3>

        <p>
          <label>PC-nivÃ¥</label><br>
          <select id="pcKrav">
            <option value="">â€“ Ej relevant â€“</option>
            <option value="low">Low</option>
            <option value="mid">Mid</option>
            <option value="high">High</option>
            <option value="extreme">Extreme</option>
          </select>
        </p>

        <p>
          <label>GPU-krav (referens)</label><br>
          <select id="gpuKrav">
            <option value="">â€“ VÃ¤lj grafikkort â€“</option>
          </select>
        </p>
      </div>

      <div class="match-actions">
        <label>
          <input type="checkbox" id="tillatUndviker">
          TillÃ¥t recensenter som undviker genren
        </label>

        <button id="matchaBtn">ğŸ” Matcha recensenter</button>
      </div>

    </div>

  </div>
</div>


<div class="panel">
  <h2>ğŸ“‹ MatchningsfÃ¶rslag</h2>
  <div id="resultat"></div>
</div>

</main>

<footer>NÃ¶rdliv â€“ internt beslutsstÃ¶d</footer>

<script src="gpu-reference.js"></script>
<script src="data.js"></script>


<script>
const genreSelect = document.getElementById("genreSelect");
const resultatDiv = document.getElementById("resultat");
const gpuKrav = document.getElementById("gpuKrav");


/* ===== FYLL GENRER ===== */
const allaGenrer = new Set();
Object.values(DATA.personerData).forEach(p => {
  [...p.alskar, ...p.oppen, ...p.undviker].forEach(g => allaGenrer.add(g));
});

[...allaGenrer].sort((a,b)=>a.localeCompare(b,"sv")).forEach(g=>{
  const o=document.createElement("option");
  o.value=o.textContent=g;
  genreSelect.appendChild(o);
});

/* ===== POÃ„NGLOGIK ===== */
function pcTierDiff(personTier, krav) {
  const ordning = ["low","mid","high","extreme"];
  return ordning.indexOf(personTier) - ordning.indexOf(krav);
}

function matcha() {
  const genre = genreSelect.value;
  const plattform = document.getElementById("plattformSelect").value;
  const pcKrav = document.getElementById("pcKrav").value;
  const tillatUndviker = document.getElementById("tillatUndviker").checked;

  if (!genre || !plattform) return;

  const resultat = [];
  
  const gpuVald = gpuKrav.value;

let kravTier = null;
if (gpuVald) {
  kravTier = GPU_REFERENCE[gpuVald].tier;
}


  Object.entries(DATA.personerData).forEach(([namn, d]) => {
    let score = 0;
    const reasons = [];

    /* Plattform */
    if (!d.plattformar || !d.plattformar.includes(plattform)) return;
    score += 2;
    reasons.push("âœ” Plattform stÃ¶ds (+2)");
	

/* ===== GPU-KRAV ===== */
if (kravTier) {
  if (plattform !== "PC") {
    reasons.push("â„¹ï¸ GPU-krav ignoreras fÃ¶r konsolspel");
  } else {
    if (!d.pcTier) return;

    if (klararGpu(d.pcTier, kravTier)) {
      score += 2;
      reasons.push("âœ” GPU klarar rekommenderad nivÃ¥");
    } else {
      reasons.push("âŒ GPU under rekommenderad nivÃ¥");
      return;
    }
  }
}


    /* Genre */
    if (d.alskar.includes(genre)) {
      score += 3;
      reasons.push("âœ” Ã„lskar genren (+3)");
    } else if (d.oppen.includes(genre)) {
      score += 1;
      reasons.push("âœ” Ã–ppen fÃ¶r genren (+1)");
    } else if (d.undviker.includes(genre)) {
      if (!tillatUndviker) return;
      score -= 3;
      reasons.push("âš  Undviker genren (âˆ’3)");
    }

    /* PC-tier */
    if (plattform === "PC" && pcKrav) {
      if (!d.pcTier) return;
      const diff = pcTierDiff(d.pcTier, pcKrav);

      if (diff < -1) return;
      if (diff === -1) {
        score -= 1;
        reasons.push("âš  PC-tier under kravet (âˆ’1)");
      } else if (diff === 0) {
        score += 2;
        reasons.push("âœ” PC-tier matchar (+2)");
      } else {
        score += 1;
        reasons.push("âœ” PC-tier Ã¶ver kravet (+1)");
      }
    }

    resultat.push({ namn, score, reasons });
  });

  resultat.sort((a,b)=>b.score-a.score);
  render(resultat);
}

if (typeof GPU_REFERENCE !== "undefined") {

  // Bygg lista med { name, tier }
  const gpuLista = Object.entries(GPU_REFERENCE).map(
    ([name, data]) => ({
      name,
      tier: data.tier
    })
  );

  // Sortera: tier (low â†’ extreme), sedan alfabetiskt
  gpuLista.sort((a, b) => {
    const tierDiff =
      TIER_ORDER.indexOf(a.tier) -
      TIER_ORDER.indexOf(b.tier);

    if (tierDiff !== 0) return tierDiff;

    return a.name.localeCompare(b.name, "sv");
  });

  // Skapa dropdown
  gpuLista.forEach(gpu => {
    const o = document.createElement("option");
    o.value = gpu.name;
    o.textContent = gpu.name;
    gpuKrav.appendChild(o);
  });
}



/* ===== RENDER ===== */
function render(lista) {
  if (!lista.length) {
    resultatDiv.innerHTML = "<em>Ingen lÃ¤mplig match hittades.</em>";
    return;
  }

  resultatDiv.innerHTML = lista.map((r,i)=>`
    <div class="result">
      <div class="score ${r.score>=6?'good':r.score>=3?'warn':'bad'}">
        ${i+1}. ${r.namn} â€“ ${r.score.toFixed(1)} poÃ¤ng
      </div>
      <div class="reason">
        ${r.reasons.join("<br>")}
      </div>
    </div>
  `).join("");
}

document.getElementById("matchaBtn").onclick = matcha;
</script>

</body>
</html>

